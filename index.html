<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- Updated Viewport for Mobile App feel -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>OneGuyStudio - Pro Simulation</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/Draggable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/TextPlugin.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;600&family=Permanent+Marker&family=Montserrat:wght@700;900&display=swap');

        /* --- Global Reset & Scene --- */
        body {
            background-color: #050505;
            color: white;
            font-family: 'Montserrat', sans-serif;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0;
            user-select: none;
            touch-action: none; /* Prevents scrolling on mobile */
            -webkit-tap-highlight-color: transparent;
        }

        #scene-container {
            width: 1000px;
            height: 650px;
            position: relative;
            transform-origin: center center;
            overflow: hidden; 
            /* Ensure smooth scaling on mobile */
            will-change: transform;
        }

        /* --- Rotate Device Message (Mobile Portrait) --- */
        #rotate-message {
            display: none;
            position: fixed;
            inset: 0;
            background: #0f172a;
            z-index: 9999;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 20px;
        }
        #rotate-message svg { width: 64px; height: 64px; fill: #38bdf8; margin-bottom: 20px; animation: rotatePhone 2s infinite; }
        #rotate-message h2 { font-size: 1.5rem; color: #fff; margin-bottom: 10px; }
        #rotate-message p { color: #94a3b8; font-family: 'Fira Code', monospace; font-size: 0.9rem; }

        @keyframes rotatePhone {
            0%, 10% { transform: rotate(0deg); }
            40%, 60% { transform: rotate(90deg); }
            90%, 100% { transform: rotate(0deg); }
        }

        /* Show rotate message only on portrait mobile devices */
        @media (max-width: 900px) and (orientation: portrait) {
            #rotate-message { display: flex; }
            #scene-container { display: none; } /* Hide scene to save resources/confusion */
        }

        /* --- Lighting Layer --- */
        #darkness-layer {
            position: absolute;
            top: 0; left: 0; 
            width: 100%; height: 100%;
            background: radial-gradient(circle 350px at var(--x, 50%) var(--y, 50%), transparent 0%, rgba(5, 5, 8, 0.98) 100%);
            z-index: 100; 
            pointer-events: none;
            transition: opacity 1.5s ease-in-out;
        }
        body.lights-on { background: #1e293b; } 
        body.lights-on #darkness-layer { opacity: 0; }

        /* --- Wall (Everything here fades in/out with light) --- */
        #wall-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 1; opacity: 0.15; transition: opacity 1s;
        }
        body.lights-on #wall-layer { opacity: 1; }

        .logo-area { position: absolute; top: 60px; left: 50px; text-align: left; }
        .studio-logo { font-size: 3rem; color: #e2e8f0; text-shadow: 0 0 10px rgba(255,255,255,0.1); line-height: 1; }
        .studio-sub { font-family: 'Fira Code', monospace; color: #94a3b8; font-size: 1.5rem; margin-top: 5px; font-weight: bold; letter-spacing: 2px; }

        .wall-clock {
            position: absolute; top: 60px; right: 80px; width: 100px; height: 100px;
            border: 4px solid #475569; border-radius: 50%; background: #0f172a;
            display: flex; justify-content: center; align-items: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }
        .clock-hand { position: absolute; background: #94a3b8; transform-origin: bottom center; border-radius: 2px; }
        .hour-hand { width: 4px; height: 25px; bottom: 50%; }
        .min-hand { width: 2px; height: 35px; bottom: 50%; background: #cbd5e1; }
        .sec-hand { width: 1px; height: 40px; bottom: 50%; background: #ef4444; }

        /* General Frame Style */
        .wall-frame {
            width: 100px; height: 100px; 
            border: 2px solid #334155; 
            background: rgba(30, 41, 59, 0.5);
            border-radius: 8px; 
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: 0.3s; 
            cursor: pointer; 
            text-decoration: none;
            pointer-events: none; /* Disabled in dark */
        }
        .wall-frame svg { width: 40px; height: 40px; stroke: #64748b; transition: 0.3s; fill: none; }
        .wall-frame span { font-size: 0.7rem; color: #64748b; margin-top: 5px; font-weight: 600; transition: 0.3s; }
        
        /* Specific rule for filled icons to ensure they are visible in grey */
        .wall-frame .filled-icon { stroke: none !important; fill: #64748b !important; transition: 0.3s; }

        /* Interaction when lights on */
        body.lights-on .wall-frame { pointer-events: auto; background: rgba(30, 41, 59, 1); }

        /* Standard Frames Hover (Right side) */
        .frames-group { position: absolute; top: 180px; right: 100px; display: flex; gap: 20px; }
        body.lights-on .frames-group .wall-frame:hover { transform: translateY(-5px); border-color: #38bdf8; }
        body.lights-on .frames-group .wall-frame:hover svg { stroke: #38bdf8; }
        body.lights-on .frames-group .wall-frame:hover span { color: #38bdf8; }

        /* Left Frames (Community/GitHub) */
        .left-frames {
            position: absolute; top: 180px; left: 50px; 
            display: flex; flex-direction: row; gap: 20px; 
        }

        /* Discord Style */
        body.lights-on .discord-frame:hover {
            transform: translateY(-5px);
            border-color: #5865F2; 
            background: rgba(88, 101, 242, 0.15);
            box-shadow: 0 0 20px rgba(88, 101, 242, 0.4);
        }
        body.lights-on .discord-frame:hover .filled-icon { fill: #5865F2 !important; }
        body.lights-on .discord-frame:hover span { color: #5865F2; }

        /* GitHub Style */
        body.lights-on .github-frame:hover {
            transform: translateY(-5px);
            border-color: #ffffff; 
            background: rgba(255, 255, 255, 0.1);
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
        }
        body.lights-on .github-frame:hover .filled-icon { fill: #ffffff !important; }
        body.lights-on .github-frame:hover span { color: #ffffff; }

        /* Copyright Footer */
        .copyright {
            position: absolute; bottom: 20px; width: 100%; text-align: center;
            font-family: 'Fira Code', monospace; font-size: 0.8rem; color: #475569; letter-spacing: 1px; pointer-events: none;
        }

        /* --- Ceiling Rig --- */
        #ceiling-rig { position: absolute; top: -100px; left: 50%; transform: translateX(-50%); z-index: 50; }
        .rig-rod { width: 4px; height: 120px; background: #333; margin: 0 auto; }
        .fan-hub {
            position: relative; width: 50px; height: 40px; background: #222; margin: -5px auto 0;
            border-radius: 4px; z-index: 2; display: flex; justify-content: center; align-items: flex-end;
        }
        .light-bulb { width: 30px; height: 15px; background: #fff; border-radius: 0 0 15px 15px; opacity: 0.2; transition: opacity 0.2s; }
        .light-cone {
            position: absolute; top: 35px; left: -275px; width: 600px; height: 520px;
            background: radial-gradient(ellipse at top, rgba(255, 247, 214, 0.3), rgba(255, 247, 214, 0.05) 80%, transparent 100%);
            clip-path: polygon(50% 0%, 0% 100%, 100% 100%); opacity: 0; pointer-events: none; mix-blend-mode: overlay;
        }
        body.lights-on .light-bulb { opacity: 1; box-shadow: 0 0 30px white; background: #fffbeb; }
        body.lights-on .light-cone { animation: flickerOn 0.4s forwards; }
        .fan-blade { position: absolute; top: 15px; left: -75px; width: 200px; height: 4px; background: #111; border-radius: 2px; z-index: 1; }

        #rope-container { position: absolute; top: 140px; left: -12px; width: 100px; height: 400px; z-index: 60; overflow: visible; }
        #pull-knob { cursor: grab; fill: #ef4444; stroke: #fff; stroke-width: 2; transition: fill 0.2s; }
        #pull-knob:active { cursor: grabbing; fill: #dc2626; }

        /* --- Furniture --- */
        .floor { position: absolute; bottom: 80px; width: 100%; height: 2px; background: #94a3b8; z-index: 5; opacity: 0.5; }

        .side-wall { position: absolute; top: 0; bottom: 80px; width: 40px; background: #0f172a; z-index: 10; border-right: 1px solid #334155; }
        .wall-left { left: 0; border-right: 2px solid #334155; }
        .wall-right { right: 0; border-left: 2px solid #334155; border-right: none; }

        /* Compact Desk */
        #workspace { position: absolute; bottom: 82px; right: 260px; width: 80px; height: 200px; z-index: 10; }
        .desk-leg { position: absolute; bottom: 0; width: 6px; height: 95px; background: #334155; }
        .leg-left { left: 8px; }
        .leg-right { right: 8px; }
        .desk-top { position: absolute; bottom: 95px; left: 0; width: 100%; height: 8px; background: #78350f; border-radius: 2px; box-shadow: 0 2px 5px rgba(0,0,0,0.5); z-index: 2; }
        .desk-light-strip { position: absolute; bottom: 93px; left: 10px; width: 60px; height: 2px; background: #0ea5e9; box-shadow: 0 5px 15px 2px rgba(14, 165, 233, 0.8); border-radius: 2px; opacity: 0.6; z-index: 105; transition: opacity 0.5s, box-shadow 0.5s; }
        body.lights-on .desk-light-strip { opacity: 0.9; box-shadow: 0 5px 25px 4px rgba(56, 189, 248, 0.9); }
        .keyboard { position: absolute; bottom: 103px; left: 10px; width: 35px; height: 3px; background: #94a3b8; border-radius: 1px; opacity: 0.8; }
        .monitor-stand { position: absolute; bottom: 103px; right: 15px; width: 10px; height: 18px; background: linear-gradient(to right, #1e293b, #334155); clip-path: polygon(20% 0%, 80% 0%, 100% 100%, 0% 100%); }
        .monitor { position: absolute; bottom: 118px; right: 8px; width: 6px; height: 75px; background: #0f172a; transform: rotate(-2deg); border-radius: 2px; z-index: 105; }
        .screen-glow { position: absolute; top: 2px; left: -3px; width: 3px; height: 71px; background: #0ea5e9; transition: 0.5s; box-shadow: -15px 0 30px rgba(14, 165, 233, 0.6); z-index: 106; }
        body.lights-on .screen-glow { background: #38bdf8; box-shadow: -30px 0 60px rgba(56, 189, 248, 0.9); }

        .monitor-beam { position: absolute; bottom: 125px; right: 220px; width: 140px; height: 140px; background: radial-gradient(circle at left center, rgba(14, 165, 233, 0.3), transparent 70%); transform: rotate(-10deg); z-index: 101; pointer-events: none; opacity: 0.4; filter: blur(8px); transition: opacity 0.8s, background 0.8s; mix-blend-mode: screen; }
        body.lights-on .monitor-beam { opacity: 0.7; background: radial-gradient(circle at left center, rgba(56, 189, 248, 0.5), transparent 75%); }

        /* Character Rig */
        #char-wrapper { position: absolute; bottom: 82px; right: 220px; width: 240px; height: 240px; z-index: 20; overflow: visible; }
        .zzz-text { font-family: 'Fira Code', monospace; fill: #94a3b8; font-weight: bold; opacity: 0; }

        @keyframes flickerOn { 0% { opacity: 0; } 100% { opacity: 1; } }
    </style>
</head>
<body>

    <!-- Mobile Rotate Message -->
    <div id="rotate-message">
        <svg viewBox="0 0 24 24"><path d="M16.48 2.52c3.27 1.55 5.61 4.72 5.97 8.48h1.5C23.44 4.84 18.29 0 12 0l-.66.03l3.81 3.81 1.33-1.32zm-6.25-.77c-.59-.59-1.54-.59-2.12 0L1.75 8.11c-.59.59-.59 1.54 0 2.12l12.02 12.02c.59.59 1.54.59 2.12 0l6.36-6.36c.59-.59.59-1.54 0-2.12L10.23 1.75zm4.6 19.44L2.81 9.17l6.36-6.36l12.02 12.02l-6.36 6.36zm-7.31.29C4.25 19.94 1.91 16.76 1.55 13H.05C.56 19.16 5.71 24 12 24l.66-.03l-3.81-3.81l-1.33 1.32z"/></svg>
        <h2>يرجى تدوير الجهاز</h2>
        <p>لتجربة المحاكاة بشكل أفضل، يرجى استخدام الوضع الأفقي.</p>
    </div>

    <div id="scene-container">
        
        <div id="darkness-layer"></div>

        <div class="side-wall wall-left"></div>
        <div class="side-wall wall-right"></div>
        <div class="floor"></div>

        <!-- Wall Layer (Everything inside here fades with light) -->
        <div id="wall-layer">
            <div class="logo-area">
                <h1 class="studio-logo">ONEGUY</h1>
                <div class="studio-sub">STUDIO</div>
            </div>
            
            <div class="left-frames">
                <!-- Discord -->
                <a href="https://discord.gg/wYq59W2qte" target="_blank" class="wall-frame discord-frame">
                    <svg class="filled-icon" viewBox="0 0 24 24">
                        <path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515a.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0a12.64 12.64 0 0 0-.617-1.25a.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057a19.9 19.9 0 0 0 5.993 3.03a.078.078 0 0 0 .084-.028a14.09 14.09 0 0 0 1.226-1.994a.076.076 0 0 0-.041-.106a13.107 13.107 0 0 1-1.872-.892a.077.077 0 0 1-.008-.128a10.2 10.2 0 0 0 .372-.292a.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127a12.299 12.299 0 0 1-1.873.892a.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028a19.839 19.839 0 0 0 6.002-3.03a.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.956-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.42c0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.955-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.42c0 1.333-.946 2.418-2.157 2.418z"/>
                    </svg>
                    <span>COMMUNITY</span>
                </a>
                
                <!-- GitHub -->
                <a href="https://github.com/1oneguystudio" target="_blank" class="wall-frame github-frame">
                    <svg class="filled-icon" viewBox="0 0 24 24">
                        <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                    </svg>
                    <span>GITHUB</span>
                </a>
            </div>

            <div class="wall-clock">
                <div class="clock-hand hour-hand"></div>
                <div class="clock-hand min-hand"></div>
                <div class="clock-hand sec-hand"></div>
            </div>
            
            <div class="frames-group">
                <div class="wall-frame">
                    <svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="5" y="2" width="14" height="20" rx="2" ry="2"></rect>
                        <line x1="12" y1="18" x2="12.01" y2="18"></line>
                    </svg>
                    <span>APPS</span>
                </div>
                <div class="wall-frame">
                    <svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 12a4.9 4.9 0 0 0-5-5H8a4.9 4.9 0 0 0-5 5v3a2 2 0 0 0 4 0l1-2h8l1 2a2 2 0 0 0 4 0v-3z"></path>
                        <path d="M6 12h4"></path>
                        <path d="M8 10v4"></path>
                        <line x1="15" y1="13" x2="15.01" y2="13"></line>
                        <line x1="18" y1="11" x2="18.01" y2="11"></line>
                    </svg>
                    <span>GAMES</span>
                </div>
            </div>

            <!-- COPYRIGHT FOOTER -->
            <div class="copyright">© 2026 OneGuyStudio</div>
        </div>

        <div id="ceiling-rig">
            <div class="rig-rod"></div>
            <div class="fan-hub">
                <div class="fan-blade"></div>
                <div class="light-bulb"></div>
                <div class="light-cone"></div>
            </div>
            <svg id="rope-container">
                <path id="rope-path" d="M 50 0 Q 50 50 50 150" stroke="#64748b" stroke-width="2" fill="none"/>
                <circle id="pull-knob" cx="50" cy="150" r="6" />
            </svg>
        </div>

        <div class="monitor-beam"></div>

        <div id="workspace">
            <div class="desk-leg leg-left"></div>
            <div class="desk-leg leg-right"></div>
            <div class="desk-top"></div>
            <div class="desk-light-strip"></div> 
            <div class="keyboard"></div>
            <div class="monitor-stand"></div>
            <div class="monitor"><div class="screen-glow"></div></div>
        </div>

        <svg id="char-wrapper" viewBox="0 0 200 200">
            <defs>
                <linearGradient id="bodyGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" style="stop-color:#f1f5f9;stop-opacity:0" />
                    <stop offset="40%" style="stop-color:#f1f5f9;stop-opacity:1" />
                </linearGradient>
            </defs>
            
            <g id="pet-zone" transform="translate(20, 195)">
                <ellipse cx="20" cy="0" rx="25" ry="8" fill="#475569" opacity="0.8" />
                <g id="cat">
                    <path d="M 5 -3 Q 15 -13 35 -3" stroke="#94a3b8" stroke-width="12" stroke-linecap="round" fill="none" />
                    <circle cx="35" cy="-2" r="5" fill="#94a3b8" />
                    <path d="M 32 -6 L 30 -10 L 36 -6" fill="#94a3b8" />
                    <path d="M 38 -6 L 42 -10 L 40 -6" fill="#94a3b8" />
                    <path d="M 5 -3 Q -2 -8 2 -12" stroke="#94a3b8" stroke-width="3" fill="none" stroke-linecap="round" />
                </g>
            </g>

            <g id="chair">
                <rect x="50" y="90" width="8" height="55" rx="2" fill="#334155" /> 
                <rect x="50" y="135" width="55" height="8" rx="2" fill="#475569" /> 
                <rect x="75" y="143" width="6" height="52" fill="#0f172a" /> 
                <rect x="60" y="195" width="40" height="5" rx="2" fill="#0f172a" /> 
                <circle cx="65" cy="203" r="3" fill="#0f172a" />
                <circle cx="95" cy="203" r="3" fill="#0f172a" />
            </g>

            <g id="zzz-group">
                <text x="60" y="70" class="zzz-text" font-size="16">Z</text>
                <text x="75" y="60" class="zzz-text" font-size="20">Z</text>
                <text x="95" y="50" class="zzz-text" font-size="24">Z</text>
            </g>

            <g id="stickman" stroke="#f1f5f9" stroke-width="5" stroke-linecap="round" fill="none">
                <path id="body" d="M 70 80 L 65 135" stroke="url(#bodyGradient)" /> 
                <g id="head-group" transform-origin="70 80">
                    <circle cx="70" cy="80" r="16" fill="#0f172a" stroke-width="0" />
                    <circle cx="70" cy="80" r="16" stroke="#f1f5f9" stroke-width="3" fill="none" />
                    <path id="eye-closed" d="M 72 80 L 80 80" stroke-width="2" />
                    <circle id="eye-open" cx="78" cy="78" r="2" fill="#fff" stroke="none" opacity="0" />
                </g>
                <g id="legs">
                    <path id="leg-back" d="M 65 135 L 95 135 L 95 185" opacity="0.6" stroke-width="4" />
                    <path id="leg-front" d="M 65 135 L 100 135 L 105 185" />
                </g>
                <g id="arms">
                    <path id="arm-back" d="M 68 100 L 80 120 L 90 120" opacity="0.6" stroke-width="4" />
                    <path id="arm-front" d="M 68 100 L 85 120 L 100 120" />
                </g>
                
                <g id="coffee-mug" opacity="1">
                    <path d="M 0 0 L 0 14 Q 5 18 10 14 L 10 0 Z" fill="#f59e0b" stroke="none" />
                    <path d="M 10 4 Q 14 7 10 10" stroke="#f59e0b" stroke-width="2" fill="none"/>
                </g>
            </g>
        </svg>

    </div>

    <script>
        gsap.registerPlugin(Draggable, TextPlugin);

        let isLightsOn = false;
        let isTransitioning = false;
        let isSipping = false; 
        let currentScale = 1;
        let coffeeTimer = null;
        let typingTween = null;
        
        const ropeConfig = { startX: 50, startY: 0, knobRestY: 150, triggerY: 250 };
        const darkness = document.getElementById("darkness-layer");
        const container = document.getElementById("scene-container");
        let mouse = { x: window.innerWidth/2, y: window.innerHeight/2 };
        let lightPos = { x: mouse.x, y: mouse.y };

        // --- INIT: Set initial positions strictly via GSAP ---
        gsap.set("#coffee-mug", { x: 130, y: 105, rotation: 0, transformOrigin: "50% 100%" });
        
        // Cat Breathing Animation
        gsap.to("#cat", { y: -1, scaleY: 1.05, duration: 2, repeat: -1, yoyo: true, ease: "sine.inOut" });

        window.addEventListener("mousemove", e => { mouse.x = e.clientX; mouse.y = e.clientY; });
        
        gsap.ticker.add(() => {
            if(!isLightsOn) {
                // Flashlight logic relative to mouse position
                lightPos.x += (mouse.x - lightPos.x) * 0.1;
                lightPos.y += (mouse.y - lightPos.y) * 0.1;
                
                const rect = container.getBoundingClientRect();
                
                // Map global mouse position to scaled container coordinates
                let localX = (lightPos.x - rect.left) / currentScale;
                let localY = (lightPos.y - rect.top) / currentScale;

                // Clamp values to stay within container 0-100%
                const xPct = (localX / 1000) * 100;
                const yPct = (localY / 650) * 100;

                darkness.style.setProperty("--x", `${xPct}%`);
                darkness.style.setProperty("--y", `${yPct}%`);
            }
        });

        function updateClock() {
            const now = new Date();
            gsap.set(".sec-hand", { rotation: now.getSeconds() * 6 });
            gsap.set(".min-hand", { rotation: now.getMinutes() * 6 + now.getSeconds() * 0.1 });
            gsap.set(".hour-hand", { rotation: (now.getHours() % 12) * 30 + now.getMinutes() * 0.5 });
        }
        setInterval(updateClock, 1000); updateClock();

        const ropePath = document.getElementById("rope-path");
        const knob = document.getElementById("pull-knob");
        const ceilingRig = document.getElementById("ceiling-rig");

        function drawRope(knobX, knobY) {
            const midX = (ropeConfig.startX + knobX) / 2;
            const midY = (ropeConfig.startY + knobY) / 2;
            ropePath.setAttribute("d", `M ${ropeConfig.startX} ${ropeConfig.startY} Q ${knobX} ${midY} ${knobX} ${knobY}`);
        }

        Draggable.create(knob, {
            type: "x,y", bounds: { minX: -20, maxX: 20, minY: 0, maxY: 200 },
            onDrag: function() {
                const absX = this.x + ropeConfig.startX;
                const absY = this.y + ropeConfig.knobRestY;
                drawRope(absX, absY);
            },
            onDragEnd: function() {
                if (this.y + ropeConfig.knobRestY > ropeConfig.triggerY && !isTransitioning) {
                     togglePower();
                }
                gsap.to(this.target, { x: 0, y: 0, duration: 1.5, ease: "elastic.out(1, 0.2)", 
                    onUpdate: () => {
                        const currentX = gsap.getProperty(this.target, "x") + ropeConfig.startX;
                        const currentY = gsap.getProperty(this.target, "y") + ropeConfig.knobRestY;
                        drawRope(currentX, currentY);
                    }
                });
                gsap.fromTo(ceilingRig, { rotation: -2 }, { rotation: 0, duration: 2, ease: "elastic.out(1, 0.1)" });
            }
        });

        const sleepTl = gsap.timeline({ repeat: -1 });
        sleepTl.to(".zzz-text", { opacity: 0.8, y: -15, x: 5, stagger: 0.3, duration: 1.5, ease: "power1.out" })
               .to(".zzz-text", { opacity: 0, duration: 0.2 }, "-=0.5");

        let workTl;

        function startTyping() {
            typingTween = gsap.timeline({ repeat: -1, yoyo: true });
            typingTween.to("#arm-front", { y: 3, duration: 0.1, ease: "none" })
                       .to("#arm-front", { y: 0, duration: 0.1, ease: "none" });
            
            gsap.to("#arm-back", { y: -2, repeat: -1, yoyo: true, duration: 0.12 });
        }

        function stopTyping() {
            if(typingTween) typingTween.kill();
            gsap.killTweensOf("#arm-front");
            gsap.killTweensOf("#arm-back");
        }
        
        // Blink Animation Function
        function blink() {
            if (!isLightsOn) return;
            
            gsap.to("#eye-open", {
                scaleY: 0.1,
                duration: 0.15,
                yoyo: true,
                repeat: 1,
                transformOrigin: "center",
                onComplete: () => {
                    if (isLightsOn) {
                        gsap.delayedCall(Math.random() * 3 + 2, blink);
                    }
                }
            });
        }

        // --- Periodic Sip Routine ---
        function sipRoutine() {
            if (!isLightsOn || isSipping) return; 
            isSipping = true;
            stopTyping();

            gsap.set("#coffee-mug", { x: 130, y: 105, rotation: 0, transformOrigin: "50% 100%" });

            const sipTl = gsap.timeline({ 
                onComplete: () => {
                    isSipping = false;
                    if(isLightsOn) startTyping(); 
                }
            });

            // Hand to Handle
            sipTl.to("#arm-front", { attr: { d: "M 68 100 L 95 105 L 142 109" }, duration: 0.5, ease: "power2.out" })
            
            // Lift
            .to("#arm-front", { attr: { d: "M 68 100 L 90 90 L 97 79" }, duration: 0.8, ease: "power2.inOut" })
            .to("#coffee-mug", { x: 85, y: 75, rotation: -15, duration: 0.8, ease: "power2.inOut" }, "<")
            
            // Head meets cup
            .to("#head-group", { rotation: -5, duration: 0.6, ease: "power2.inOut" }, "-=0.6")

            // Tremble
            .to("#coffee-mug", { x: "+=1", y: "+=1", duration: 0.1, repeat: 5, yoyo: true, ease: "linear" })
            .to("#arm-front", { x: "+=1", y: "+=1", duration: 0.1, repeat: 5, yoyo: true, ease: "linear" }, "<")
            
            // Put Back
            .to("#head-group", { rotation: 0, duration: 0.8 })
            .to("#arm-front", { attr: { d: "M 68 100 L 95 105 L 142 109" }, duration: 0.8, ease: "power2.inOut" }, "<")
            .to("#coffee-mug", { x: 130, y: 105, rotation: 0, duration: 0.8, ease: "power2.inOut" }, "<")
            
            // Return Arm
            .to("#arm-front", { attr: { d: "M 68 100 L 90 110 L 115 110" }, duration: 0.5 });
        }

        function togglePower() {
            isTransitioning = true;
            isLightsOn = !isLightsOn;

            if (isLightsOn) {
                document.body.classList.add("lights-on");
                gsap.to(".fan-blade", { scaleX: 0.1, duration: 0.15, repeat: -1, yoyo: true, ease: "linear" });
                sleepTl.pause();
                gsap.to(".zzz-text", { opacity: 0 });

                workTl = gsap.timeline({ onComplete: () => {
                    isTransitioning = false;
                    startTyping(); 
                    coffeeTimer = setInterval(sipRoutine, 15000);
                    // Start Blinking Loop
                    gsap.delayedCall(2, blink);
                }});

                workTl
                    .to("#head-group", { rotation: 0, y: 0, duration: 0.5, ease: "power2.out" }) 
                    // FIX: Body stays anchored at 70,80 (center of head)
                    .to("#body", { attr: { d: "M 70 80 L 65 135" }, duration: 0.5, ease: "power2.out" }, "<") 
                    .to("#eye-closed", { opacity: 0, duration: 0.1 }, "<")
                    .to("#eye-open", { opacity: 1, duration: 0.1 }, "<")
                    .to("#head-group", { x: 5, duration: 0.4 })
                    .to("#body", { attr: { d: "M 75 80 L 65 135" }, duration: 0.4 }, "<") 
                    .to("#arm-front", { attr: { d: "M 72 100 L 90 110 L 115 110" }, duration: 0.5 }, "<")
                    .to("#arm-back", { attr: { d: "M 72 100 L 85 110 L 110 110" }, duration: 0.5 }, "<");

            } else {
                document.body.classList.remove("lights-on");
                
                clearInterval(coffeeTimer);
                stopTyping();
                isSipping = false; 
                gsap.to(".fan-blade", { scaleX: 1, duration: 1, overwrite: true });
                gsap.to("#coffee-mug", { x: 130, y: 105, rotation: 0, duration: 0.5 });
                
                // Kill Blink
                gsap.killTweensOf("#eye-open");
                gsap.killTweensOf(blink);

                if(workTl) workTl.kill();
                gsap.killTweensOf("#head-group"); gsap.killTweensOf("#body");

                const sleepResetTl = gsap.timeline({ onComplete: () => { isTransitioning = false; sleepTl.restart(); }});
                sleepResetTl
                    // Sleep: Head rotates, body stays anchored at M 70 80
                    .to("#head-group", { x: 0, y: 0, rotation: 5, duration: 0.8, ease: "power2.inOut" })
                    .to("#body", { attr: { d: "M 70 80 L 65 135" }, duration: 0.8, ease: "power2.inOut" }, "<") 
                    
                    .to("#arm-front", { attr: { d: "M 68 100 L 85 120 L 100 120" }, y: 0, duration: 0.8 }, "<")
                    .to("#arm-back", { attr: { d: "M 68 100 L 80 120 L 90 120" }, y: 0, duration: 0.8 }, "<")
                    .to("#eye-open", { opacity: 0, duration: 0.1 }, "-=0.4")
                    .to("#eye-closed", { opacity: 1, duration: 0.1 }, "<");
            }
        }
        function resize() {
            currentScale = Math.min(window.innerWidth / 1000, window.innerHeight / 650);
            gsap.set(container, { scale: currentScale });
        }
        window.addEventListener("resize", resize); resize();
    </script>
</body>
</html>
